<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LinkShrinker - Shorten, Track, and Manage Your Links</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    header {
      background-color: #3399ff;
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    h1,
    h2 {
      margin: 0;
      padding: 0;
    }

    main {
      padding: 20px;
    }

    .shorten-url,
    .url-history {
      background-color: #fff;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .shorten-url form {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .shorten-url label {
      flex: 0 0 100%;
      margin-bottom: 10px;
      color: #333;
    }

    .shorten-url input {
      flex: 1;
      margin-right: 10px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }

    .shorten-url input:focus {
      outline: none;
      border-color: #3399ff;
    }

    .shorten-url button {
      flex: 0 0 auto;
      background-color: #3399ff;
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .shorten-url button:hover {
      background-color: #228cff;
    }

    .success-message {
      color: green;
      margin-top: 10px;
    }

    .url-history table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .url-history th,
    .url-history td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
      overflow: hidden;
      text-overflow: ellipsis;
      word-wrap: break-word;
    }

    .url-history th:first-child,
    .url-history td:first-child {
      width: 5%;
    }

    .url-history th:nth-child(2),
    .url-history td:nth-child(2) {
      width: 55%;
    }

    .url-history th:nth-child(3),
    .url-history td:nth-child(3) {
      width: 20%;
    }

    .url-history th:nth-child(4),
    .url-history td:nth-child(4) {
      width: 10%;
    }

    .url-history th:nth-child(5),
    .url-history td:nth-child(5) {
      width: 5%;
    }

    .url-history th:nth-child(6),
    .url-history td:nth-child(6) {
      width: 5%;
    }

    .delete-icon {
      color: red;
      cursor: pointer;
    }

    .delete-icon:hover {
      color: darkred;
    }

    .url-history {
      background-color: #dfefff;
    }

    .error-message {
      color: red;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <header style="background-color: #3399ff; color: white; padding: 40px 20px; position: relative;">
    <!-- Logout Button at Top-Right -->
    <form action="/logout" method="POST" onsubmit="return confirm('Are you sure you want to logout?');"
      style="position: absolute; top: 50px; right: 50px;">
      <button type="submit" style="
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    ">
        Logout
      </button>
    </form>

    <!-- Centered Title and Subtitle -->
    <div style="text-align: center;">
      <h1 style="margin: 0;">LinkShrinker</h1>
      <p style="margin: 0;">Shorten, Track, and Manage Your Links with Ease</p>
    </div>
  </header>

  <main>
    <section class="shorten-url">
      <h2>Shorten Your Links</h2>
      <form method="POST" action="/url">
        <label for="url">Enter Your Original URL</label>
        <input type="text" id="url" name="url" placeholder="https://link-shrinker.vercel.app/login" required />
        <button type="submit">Shorten</button>
      </form>

      <!-- Check if the link is already quite small and display a message -->
      <% if (locals.smallLinkMessage) { %>
        <p class="error-message">
          <%= smallLinkMessage %>
        </p>
        <% } %>

          <!-- Check if a shortened URL was generated and display it -->
          <% if (locals.id) { %>
            <p class="success-message">
              Your shortened URL is:
              <a href="https://link-shrinker.vercel.app/url/<%= id %>" target="_blank">
                https://link-shrinker.vercel.app/url/<%= id %>
              </a>
            </p>
            <% } %>
    </section>

    <% if (locals.urls) { %>
      <section class="url-history">
        <h2>Your Link History</h2>
        <table>
          <thead>
            <tr>
              <th>S. No</th>
              <th>Original URL</th>
              <th>Shrinked URL</th>
              <th>ShortID</th>
              <th>Clicks</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            <% urls.forEach((url, index)=> { %>
              <tr>
                <td>
                  <%= index + 1 %>
                </td>
                <td>
                  <a href="<%= url.redirectURL %>" target="_blank">
                    <%= url.redirectURL %>
                  </a>
                </td>
                <td>
                  <a href="https://link-shrinker.vercel.app/url/<%= url.shortId %>"
                    target="_blank">https://link-shrinker.vercel.app/url/<%= url.shortId %>
                  </a>
                </td>
                <td>
                  <%= url.shortId %>
                </td>
                <td>
                  <%= url.visitHistory.length %>
                </td>
                <td>
                  <form action="/url/delete/<%= url.shortId %>?_method=DELETE" method="POST" style="display:inline;"
                    onsubmit="return confirm('Are you sure you want to delete this URL?');">
                    <button type="submit" style="background:none;border:none;color:red;cursor:pointer;">
                      <i class="fas fa-trash delete-icon"></i>
                    </button>
                  </form>

                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </section>
      <% } %>
  </main>
</body>

</html>